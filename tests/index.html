<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width">
		<title>QUnit Example</title>
		<link rel="stylesheet" href="https://code.jquery.com/qunit/qunit-2.0.1.css">
		<style>
			.test-message {
				white-space: pre;
			}

			ol.qunit-assert-list li {
				list-style: none;
			}
		</style>
	</head>

	<body>
		<div id="qunit"></div>
		<script src="https://code.jquery.com/qunit/qunit-2.0.1.js"></script>
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
		<script src="./blanket.js"></script>
		<script src="../jquery.el.js" data-cover></script>
		<script>
			function eq(title, text, expected) {
				QUnit.test(title, function(assert) {
					var actual = $.el(text)[0].outerHTML;
					assert.deepEqual(actual, expected, "$.el(" + JSON.stringify(text) + ")[0].outerHTML\nActual: " + JSON.stringify(actual) + "\nExpected: " + JSON.stringify(expected) + "");
				});
			}

			function err(title, text, expected) {
				QUnit.test(title, function(assert) {
					var actual;
					try {
						$.el(text);
					} catch (error) {
						actual = error;
					}
					assert.deepEqual(actual, expected, "$.el(" + JSON.stringify(text) + ")\nActual: throws " + JSON.stringify(actual) + "\nExpected: throws " + JSON.stringify(expected) + "");
				});
			}

			var undef;
			eq("undefined", undef, '<div></div>');
			eq("nothing", "", '<div></div>');
			err("number", 1, "invalid input");
			eq("space", " ", '<div></div>');

			QUnit.module("tag");
			eq("regular", "span", '<span></span>');
			eq("unknown", "unknown", '<unknown></unknown>');
			eq("spaces", " span ", '<span></span>');

			QUnit.module("id");
			eq("single", "#div", '<div id="div"></div>');
			err("empty", "#", "id cannot be empty");
			eq("spaces around", " #div ", '<div id="div"></div>');
			err("multiple", "#div1#div2", "cannot have multiple ids");
			err("invalid char", "#div1!", "'!' is not a valid start of a token");
			err("invalid char", "#!div1", "'!' is not a valid id character");

			QUnit.module("class");
			eq("single", ".div", '<div class="div"></div>');
			err("empty", ".", "class cannot be empty");
			eq("multiple", ".div1.div2", '<div class="div1 div2"></div>');
			err("invalid char", ".!div1", "'!' is not a valid class character");

			QUnit.module("attr");
			eq("no quote", "[data-test=test]", '<div data-test="test"></div>');
			eq("single quote", "[data-test='test']", '<div data-test="test"></div>');
			eq("double quote", "[data-test=\"test\"]", '<div data-test="test"></div>');
			eq("single quote in no quote", "[data-test=t'est]", '<div data-test="t\'est"></div>');
			eq("double quote in no quote", "[data-test=t\"est]", '<div data-test="t&quot;est"></div>');
			eq("spaces no quotes", "[ data-test = test ]", '<div data-test="test"></div>');
			eq("spaces single quotes", "[ data-test = ' test ' ]", '<div data-test=" test "></div>');
			eq("spaces double quotes", "[ data-test = \" test \" ]", '<div data-test=" test "></div>');
			eq("single quotes in double quoted attr value", "[data-test=\"'test\"]", '<div data-test="\'test"></div>');
			eq("escaped double quote in double quoted attr value", "[data-test=\"\\\"test\"]", '<div data-test="&quot;test"></div>');
			eq("escaped double quote in single quoted attr value", "[data-test='\\\"test']", '<div data-test="&quot;test"></div>');
			eq("escaped single quote in single quoted attr value", "[data-test='\\'test']", '<div data-test="\'test"></div>');
			eq("escaped single quote in double quoted attr value", "[data-test=\"\\'test\"]", '<div data-test="\'test"></div>');
			eq("multiple", "[data-test1='test1' data-test2='test2']", '<div data-test1="test1" data-test2="test2"></div>');
			eq("multiple no strings", "[data-test1=test1 data-test2=test2]", '<div data-test1="test1" data-test2="test2"></div>');
			eq("multiple groups", "[data-test1='test1'][data-test2='test2']", '<div data-test1="test1" data-test2="test2"></div>');
			eq("empty", "[]", '<div></div>');
			eq("empty value", "[data-test]", '<div data-test=""></div>');
			eq("empty value before next attr", "[data-test data-test1='test1']", '<div data-test="" data-test1="test1"></div>');
			eq("no space between attrs", "[data-test1='test1'data-test2='test2']", '<div data-test1="test1" data-test2="test2"></div>');
			eq("new line in value", "[data-test1='tes\nt1']", '<div data-test1="tes\nt1"></div>');
			eq("non-escaped \\ in string", "[data-test1='test\\1']", '<div data-test1="test\\1"></div>');
			eq("non-escaped \\ in string at end of attr", "[data-test1='test\\ ]", '<div data-test1="test\\"></div>');
			eq("non-escaped \\ not in string", "[data-test1=test\\1]", '<div data-test1="test\\1"></div>');
			eq("non-escaped \\ not in string at end of attr", "[data-test1=test\\ ]", '<div data-test1="test\\"></div>');
			err("non-escaped \\ at end of attr missing ]", "[data-test1=test\\", "missing ']' at end of attributes token");
			err("missing ]", "[data-test1=test", "missing ']' at end of attributes token");
			eq("escaped ]", "[data-test1='test1\\]']", '<div data-test1="test1]"></div>');
			eq("escaped ] no quotes", "[data-test1=test1\\]]", '<div data-test1="test1]"></div>');
			eq("escaped \\", "[data-test1='test1\\\\']", '<div data-test1="test1\\"></div>');
			eq("escaped \\ no quotes", "[data-test1=test1\\\\]", '<div data-test1="test1\\"></div>');
			eq("escaped \\ and ]", "[data-test1='test1\\\\\\]']", '<div data-test1="test1\\]"></div>');
			eq("escaped \\ and ] no quotes", "[data-test1=test1\\\\\\]]", '<div data-test1="test1\\]"></div>');
			err("invalid name char after empty attr", "[data-test1 :data-test]", "':' is not a valid attribute name character");
			err("invalid name char", "[d:ata-test]", "':' is not a valid attribute name character");
			err("invalid name char", "[:data-test]", "':' is not a valid attribute name character");

			QUnit.module("text");
			eq("regular", "{test}", '<div>test</div>');
			eq("multiple", "{multiple}{ tests}", '<div>multiple tests</div>');
			eq("escaped }", "{test\\}}", '<div>test}</div>');
			eq("escaped \\", "{test\\\\}", '<div>test\\</div>');
			eq("non-escaped \\", "{test\\1}", '<div>test\\1</div>');
			err("non-escaped \\ at end of text missing }", "{test\\", "missing '}' at end of text token");
			eq("new line", "{te\nst}", '<div>te\nst</div>');
			eq("spaces around", "{ test }", '<div> test </div>');
			err("missing }", "{test", "missing '}' at end of text token");

			QUnit.module("typical");
			eq("usual", "span#test.t1.t2[data-test1='test1' data-test2='test2']{text}", '<span id="test" class="t1 t2" data-test1="test1" data-test2="test2">text</span>');
			eq("checkbox", "input#id.class[type='checkbox' name='name' checked]", '<input id="id" class="class" type="checkbox" name="name" checked="checked">');

			QUnit.module("advanced");
			QUnit.test("append el", function(assert) {
				var actual = $("<div/>").el("span").parent()[0].outerHTML;
				var expected = "<div><span></span></div>";
				assert.ok(actual === expected, "$('<div/>').el('span').parent()[0].outerHTML\nActual: " + JSON.stringify(actual) + "\nExpected: " + JSON.stringify(expected));
			});
			QUnit.test("return parent", function(assert) {
				var actual = $.el().el("span", true)[0].outerHTML;
				var expected = "<div><span></span></div>";
				assert.ok(actual === expected, "$.el().el('span', true)[0].outerHTML\nActual: " + JSON.stringify(actual) + "\nExpected: " + JSON.stringify(expected));
			});
		</script>
	</body>

</html>
